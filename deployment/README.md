# 🚀 Complete Deployment Guide for UIET College Website on Google Cloud

This guide will walk you through deploying the UIET College Website on Google Cloud Platform step by step.

## 📋 Prerequisites

- Google Cloud Platform account with billing enabled
- Google Cloud CLI installed on your local machine
- Domain name (optional but recommended)
- Basic knowledge of terminal/command line

## 🔧 Step 1: Set up Google Cloud Project

### 1.1 Create and Configure Project

```bash
# Create a new project
gcloud projects create uiet-college-website --name="UIET College Website"

# Set the project as default
gcloud config set project uiet-college-website

# Enable required APIs
gcloud services enable compute.googleapis.com
gcloud services enable container.googleapis.com
gcloud services enable cloudbuild.googleapis.com
```

### 1.2 Set up Billing
- Go to [Google Cloud Console](https://console.cloud.google.com)
- Navigate to Billing and link a payment method

## 🖥️ Step 2: Create VM Instance

```bash
# Create a VM instance
gcloud compute instances create uiet-server \
  --zone=us-central1-a \
  --machine-type=e2-standard-2 \
  --boot-disk-size=20GB \
  --boot-disk-type=pd-standard \
  --image-family=ubuntu-2004-lts \
  --image-project=ubuntu-os-cloud \
  --tags=http-server,https-server \
  --metadata-from-file startup-script=deployment/startup-script.sh
```

## 🔥 Step 3: Configure Firewall Rules

```bash
# Allow HTTP traffic
gcloud compute firewall-rules create allow-http \
  --allow tcp:80 \
  --source-ranges 0.0.0.0/0 \
  --target-tags http-server

# Allow HTTPS traffic  
gcloud compute firewall-rules create allow-https \
  --allow tcp:443 \
  --source-ranges 0.0.0.0/0 \
  --target-tags https-server

# Allow backend API traffic
gcloud compute firewall-rules create allow-backend \
  --allow tcp:5000 \
  --source-ranges 0.0.0.0/0 \
  --target-tags http-server
```

## 📡 Step 4: Connect to VM and Deploy

### 4.1 Connect to VM
```bash
gcloud compute ssh uiet-server --zone=us-central1-a
```

### 4.2 Run Deployment Script
```bash
# Download and run the deployment script
curl -O https://raw.githubusercontent.com/bitrebell/UIET_WEBSITE/main/deployment/deploy.sh
chmod +x deploy.sh
./deploy.sh
```

## ⚙️ Step 5: Configure Environment Variables

```bash
cd UIET_WEBSITE/backend
nano .env
```

Update the following values:
- `MONGODB_URI`: Use the one generated by the MongoDB setup
- `JWT_SECRET`: Generate a secure secret
- `EMAIL_HOST`, `EMAIL_USER`, `EMAIL_PASS`: Your email configuration
- `CLOUDINARY_*`: Your Cloudinary credentials
- `STRIPE_*`: Your Stripe keys
- `FRONTEND_URL`: Your domain or IP address

## 🗄️ Step 6: Set up Database

```bash
# Run MongoDB setup
chmod +x deployment/mongodb-setup.sh
./deployment/mongodb-setup.sh
```

This will:
- Create database and user
- Set up initial admin account
- Create indexes for performance

## 🌐 Step 7: Configure Domain (Optional)

### 7.1 Point Domain to Server
- Get your VM's external IP: `gcloud compute instances describe uiet-server --zone=us-central1-a --format='get(networkInterfaces[0].accessConfigs[0].natIP)'`
- Create A record pointing to this IP

### 7.2 Set up SSL Certificate
```bash
chmod +x deployment/ssl-setup.sh
./deployment/ssl-setup.sh your-domain.com
```

## 🔍 Step 8: Verify Deployment

### 8.1 Check Service Status
```bash
chmod +x deployment/monitor.sh
./deployment/monitor.sh
```

### 8.2 Test Application
- Frontend: `http://your-server-ip` or `https://your-domain.com`
- Backend API: `http://your-server-ip:5000/api/health`
- Admin Login: Email: `admin@uiet-college.edu`, Password: `admin123`

## 🛡️ Step 9: Security Hardening

### 9.1 Update System
```bash
sudo apt update && sudo apt upgrade -y
```

### 9.2 Configure UFW Firewall
```bash
sudo ufw allow ssh
sudo ufw allow http
sudo ufw allow https
sudo ufw allow 5000
sudo ufw enable
```

### 9.3 Change Default Passwords
- Change admin password after first login
- Update MongoDB user password
- Set strong JWT secrets

## 📊 Step 10: Set up Monitoring and Backups

### 10.1 Set up Automated Backups
```bash
chmod +x deployment/backup.sh

# Add to crontab for daily backups at 2 AM
echo "0 2 * * * /home/$(whoami)/UIET_WEBSITE/deployment/backup.sh" | crontab -
```

### 10.2 Set up Monitoring
```bash
# Run health check
./deployment/monitor.sh

# Set up regular monitoring
echo "0 */6 * * * /home/$(whoami)/UIET_WEBSITE/deployment/monitor.sh >> /var/log/uiet-monitor.log" | crontab -
```

## 🔄 Step 11: Application Management

### Common Commands
```bash
# Restart backend
pm2 restart uiet-backend

# View logs
pm2 logs uiet-backend

# Restart Nginx
sudo systemctl restart nginx

# Check MongoDB status
sudo systemctl status mongod

# Update application
cd UIET_WEBSITE
git pull
cd backend && npm install
pm2 restart uiet-backend
cd ../frontend && npm install && npm run build
sudo cp -r build/* /var/www/html/
```

## 💰 Cost Estimation

### Monthly Costs (US-Central1):
- e2-standard-2 VM: ~$52/month
- 20GB Standard Disk: ~$2/month
- Network Egress: ~$5-15/month (depending on traffic)
- **Total: ~$60-70/month**

### Cost Optimization Tips:
1. Use preemptible instances (50-70% cheaper) for development
2. Use e2-micro for testing (free tier eligible)
3. Set up budget alerts
4. Use committed use discounts for long-term deployment

## 🚨 Troubleshooting

### Common Issues:

1. **502 Bad Gateway**
   ```bash
   pm2 restart uiet-backend
   sudo systemctl restart nginx
   ```

2. **Database Connection Failed**
   ```bash
   sudo systemctl restart mongod
   # Check MongoDB logs
   sudo journalctl -u mongod
   ```

3. **SSL Certificate Issues**
   ```bash
   sudo certbot renew --dry-run
   sudo systemctl reload nginx
   ```

4. **Permission Denied**
   ```bash
   sudo chown -R www-data:www-data /var/www/html
   sudo chmod 755 -R /var/www/html
   ```

## 📞 Support

For issues or questions:
- Check logs: `pm2 logs uiet-backend`
- System monitoring: `./deployment/monitor.sh`
- Database issues: `sudo journalctl -u mongod`

## 🔐 Security Best Practices

1. Regular system updates
2. Strong passwords and JWT secrets
3. Enable MongoDB authentication
4. Use HTTPS everywhere
5. Regular backups
6. Monitor access logs
7. Keep Node.js and dependencies updated
8. Use environment variables for secrets
9. Configure rate limiting
10. Regular security audits

---

## Quick Start Commands Summary

```bash
# 1. Create VM and connect
gcloud compute instances create uiet-server --zone=us-central1-a --machine-type=e2-standard-2 --image-family=ubuntu-2004-lts --image-project=ubuntu-os-cloud --tags=http-server,https-server
gcloud compute ssh uiet-server --zone=us-central1-a

# 2. Deploy application
curl -O https://raw.githubusercontent.com/bitrebell/UIET_WEBSITE/main/deployment/deploy.sh
chmod +x deploy.sh && ./deploy.sh

# 3. Set up database
./deployment/mongodb-setup.sh

# 4. Configure SSL (if domain available)
./deployment/ssl-setup.sh your-domain.com

# 5. Monitor status
./deployment/monitor.sh
```

Your UIET College Website should now be live and accessible! 🎉
